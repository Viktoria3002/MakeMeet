<% content_for :title, "Мои спринты - Make Meet" %>

<div class="open-sprints-page">
  <div class="sprints-hero-section">
    <h1 class="sprints-hero-title">Мои активные спринты</h1>
    <p class="sprints-hero-description">Здесь отображаются спринты, к которым вы присоединились</p>
  </div>

  <div class="sprints-grid" id="mySprintsGrid">
    <!-- Спринты будут добавляться динамически через JavaScript -->
    <div class="empty-state" style="text-align: center; padding: 60px 20px; color: rgba(255, 255, 255, 0.6);">
      <p style="font-size: 1.2rem; margin-bottom: 12px;">У вас пока нет активных спринтов</p>
      <p style="font-size: 0.95rem;">Присоединяйтесь к спринтам на странице "Открытые спринты"</p>
    </div>
  </div>
</div>

<script>
  // Храним присоединенные спринты в localStorage
  function getJoinedSprints() {
    const sprints = localStorage.getItem('joinedSprints');
    return sprints ? JSON.parse(sprints) : [];
  }

  function saveJoinedSprints(sprints) {
    localStorage.setItem('joinedSprints', JSON.stringify(sprints));
  }

  function addSprint(sprintData) {
    const sprints = getJoinedSprints();
    
    // Проверяем, не присоединен ли уже этот спринт
    if (!sprints.find(s => s.id === sprintData.id)) {
      sprints.push(sprintData);
      saveJoinedSprints(sprints);
      updateMySprintsDisplay();
    }
  }

  function updateMySprintsDisplay() {
    const grid = document.getElementById('mySprintsGrid');
    const sprints = getJoinedSprints();
    
    if (sprints.length === 0) {
      grid.innerHTML = `
        <div class="empty-state" style="text-align: center; padding: 60px 20px; color: rgba(255, 255, 255, 0.6);">
          <p style="font-size: 1.2rem; margin-bottom: 12px;">У вас пока нет активных спринтов</p>
          <p style="font-size: 0.95rem;">Присоединяйтесь к спринтам на странице "Открытые спринты"</p>
        </div>
      `;
      return;
    }

    grid.innerHTML = sprints.map(sprint => `
      <div class="sprint-card">
        <div class="sprint-card-content">
          <h3 class="sprint-card-title">${sprint.title}</h3>
          <p class="sprint-card-description">${sprint.description}</p>
          <span class="sprint-card-duration">${sprint.duration}</span>
        </div>
        <div class="sprint-card-image">
          <div class="sprint-image-placeholder meditation"></div>
        </div>
      </div>
    `).join('');
  }

  // Инициализируем при загрузке страницы
  document.addEventListener('DOMContentLoaded', function() {
    updateMySprintsDisplay();
  });

  // Функция для вызова с других страниц
  window.joinSprint = function(title, description, duration, id) {
    const sprintData = {
      id: id || title,
      title: title,
      description: description,
      duration: duration
    };
    addSprint(sprintData);
  };

  // Сохраняем функции для использования на других страницах
  window.getJoinedSprints = getJoinedSprints;
  window.addSprint = addSprint;
</script>
