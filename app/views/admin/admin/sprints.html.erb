<% content_for :title, "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø—Ä–∏–Ω—Ç–∞–º–∏ - –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å" %>

<div class="admin-container">
  <div class="admin-header">
    <h1>üèÉ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø—Ä–∏–Ω—Ç–∞–º–∏</h1>
    <p>–ü—Ä–æ—Å–º–æ—Ç—Ä –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø—Ä–∏–Ω—Ç–∞–º–∏ –∏ —á–µ–ª–ª–µ–Ω–¥–∂–∞–º–∏</p>
  </div>

  <div class="admin-nav">
    <%= link_to "–ì–ª–∞–≤–Ω–∞—è", admin_root_path, class: "nav-link" %>
    <%= link_to "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏", admin_users_path, class: "nav-link" %>
    <%= link_to "–ü–æ—Å—Ç—ã", admin_posts_path, class: "nav-link" %>
    <%= link_to "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏", admin_comments_path, class: "nav-link" %>
    <%= link_to "–°–ø—Ä–∏–Ω—Ç—ã", admin_sprints_path, class: "nav-link active" %>
  </div>

  <div class="admin-table-container">
    <div class="table-header">
      <h2>–°–ø–∏—Å–æ–∫ —Å–ø—Ä–∏–Ω—Ç–æ–≤ (<%= @sprints.count %>)</h2>
    </div>

    <div class="table-responsive">
      <table class="admin-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
            <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
            <th>–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</th>
            <th>–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
            <th>–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤</th>
            <th>–ü—Ä–æ–≥—Ä–µ—Å—Å</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
        </thead>
        <tbody>
          <% @sprints.each do |sprint| %>
            <tr>
              <td><%= sprint.sprint_id || sprint.id %></td>
              <td>
                <div class="sprint-cell">
                  <strong><%= sprint.name %></strong>
                </div>
              </td>
              <td>
                <div class="content-cell">
                  <%= truncate(sprint.description, length: 60) %>
                </div>
              </td>
              <td><%= sprint.start_date.strftime("%d.%m.%Y") %></td>
              <td><%= sprint.end_date.strftime("%d.%m.%Y") %></td>
              <td>
                <% if sprint.is_active? %>
                  <span class="badge badge-success">–ê–∫—Ç–∏–≤–Ω—ã–π</span>
                <% elsif sprint.is_upcoming? %>
                  <span class="badge badge-warning">–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–π</span>
                <% else %>
                  <span class="badge badge-secondary">–ó–∞–≤–µ—Ä—à–µ–Ω</span>
                <% end %>
              </td>
              <td>
                <span class="badge badge-info"><%= sprint.participants_count %></span>
              </td>
              <td>
                <div class="progress-cell">
                  <div class="progress-bar">
                    <div class="progress-fill" style="width: <%= sprint.progress_percentage %>%"></div>
                  </div>
                  <small><%= sprint.progress_percentage %>%</small>
                </div>
              </td>
              <td>
                <div class="action-buttons">
                  <%= link_to "–£–¥–∞–ª–∏—Ç—å", 
                      admin_delete_sprint_path(sprint), 
                      method: :delete,
                      class: "btn btn-danger btn-sm",
                      confirm: "–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å–ø—Ä–∏–Ω—Ç '#{sprint.name}'?" %>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <div class="sprint-details">
      <% @sprints.each do |sprint| %>
        <div class="sprint-detail-card">
          <h3><%= sprint.name %></h3>
          <p><%= sprint.description %></p>
          <div class="sprint-meta">
            <span><strong>–ü–µ—Ä–∏–æ–¥:</strong> <%= sprint.start_date.strftime("%d.%m.%Y") %> - <%= sprint.end_date.strftime("%d.%m.%Y") %></span>
            <span><strong>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</strong> <%= sprint.duration_days %> –¥–Ω–µ–π</span>
            <span><strong>–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤:</strong> <%= sprint.participants_count %></span>
          </div>
          
          <div class="participants-list">
            <h4>–£—á–∞—Å—Ç–Ω–∏–∫–∏:</h4>
            <% sprint.sprint_participants.includes(:user).each do |participant| %>
              <div class="participant-item">
                <span><%= participant.user.username %></span>
                <span class="participant-status"><%= participant.status_in_russian %></span>
                <span class="participant-date">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è: <%= participant.join_date&.strftime("%d.%m.%Y") %></span>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
